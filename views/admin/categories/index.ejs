<h5>Categories</h5>

<div id="content">

<!-- Begin Page Content -->
<div class="container-fluid">
  <a href="/admin/logout" class="btn btn-primary btn-lg active" role="button" aria-pressed="true">Log out</a>

  <!-- DataTales Example -->
  <div class="card shadow mb-4">
    <div class="card-header py-3">
      <form
        class="d-none d-sm-inline-block form-inline mr-auto ml-md-3 my-2 my-md-0 mw-100 navbar-search"
      >
        <div class="input-group">
          <input
            type="text"
            class="form-control bg-light border-0 small"
            placeholder="Search for..."
            aria-label="Search"
            aria-describedby="basic-addon2"
          />
          <div class="input-group-append">
            <button class="btn btn-primary" type="button">
                Search
            </button>
          </div>
        </div>
      </form>
      <a href="/admin/categories/new"><button class="ml-5 btn btn-primary">New</button></a>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table
          class="table table-bordered"
          id="dataTable"
          width="100%"
          cellspacing="0"
        >
          <thead>
            <tr>
              <th>ID</th>
              <th>Name</th>
              <th>Child Category</th>
              <th>Created at</th>
              <th>Updated at</th>
            </tr>
          </thead>
          <tbody>
            <% categories.forEach(category => { %>
              <tr>
                <td><%= category.id %></td>
                <td><%= category.name %></td>
                <td>
                  <ul>
                    <% for(let i = 0; i < child_categories.length; i++) { %>
                      <% if(child_categories[i].parent_category_id == category.id) { %>
                        <li><%= child_categories[i].name %></li>

                      <% } %>
                    <% } %>
                  </ul>
                </td>
                <td><%= category.createdAt.toLocaleString('en-GB', { timeZone: 'UTC' }) %></td>
                <td><%= category.updatedAt.toLocaleString('en-GB', { timeZone: 'UTC' }) %></td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
<!-- /.container-fluid -->

<nav aria-label="Page navigation example">
  <ul class="pagination justify-content-center">
    <li class="page-item">
      <button class="page-link js-pagination_category" value="1">Previous</button>
    </li>

    <% for(let i = 1 ; i <= total; i++) { %>
      <li class="page-item <%= i == 1 ? 'active' : '' %>">
        <button class="page-link js-pagination_category" value="<%= i %>">
          <%= i %>
        </button>
      </li>
    <% } %>
    <li class="page-item">
      <button class="page-link js-pagination_category" value="<%= total %>">Next</button>
    </li>
  </ul>
</nav>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
<script>
  $(() => {
    $(".js-pagination_category").click(function() {
      $(".pagination").find("li").removeClass("active")
      $(this).parent().addClass("active");

      const offset = $(this).val().split(' ').join('');

      $.ajax({
        type: "GET",
        url: "/ajax/categories",
        dataType: "JSON",
        data: { offset: offset },
        success: (data) => {
          const categories = data["categories"];
          const child_categories = data["child_categories"];

          if(categories.length > 0) {
            let html = ``

            for(let i = 0; i < categories.length; i++) {
              let child_categories_html = ``

              for(let j = 0; j < child_categories.length; j++) {
                if(child_categories[j].parent_category_id === categories[i].id) {
                  child_categories_html += `
                  <li>${child_categories[j].name}</li>
                  `
                }
              }

              html += `
                <tr>
                  <td>${categories[i].id}</td>
                  <td>${categories[i].name}</td>
                  <td>
                    <ul>
                      ${child_categories_html}
                    </ul>
                  </td>
                  <td>${categories[i].createdAt.toLocaleString('en-GB', { timeZone: 'UTC' })}</td>
                  <td>${categories[i].updatedAt.toLocaleString('en-GB', { timeZone: 'UTC' })}</td>
                </tr>
              `
            }

            $('#dataTable > tbody:last-child').html(html);
          }
        },
        error: (error) => {
        }
      })
    })
  })
</script>